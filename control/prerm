#!/bin/sh

# Remove the ipkg wrapper
rm -f /usr/local/bin/ipkg

# Stop the service
/sbin/stop org.webosinternals.ipkgservice

# New app installation area?
if [ -d /media/cryptofs/apps ] ; then
  # Remove obsolete paths
  rm -rf /var/usr/palm/applications/org.webosinternals.ipkgservice
  rm -f /var/usr/lib/luna/java/org.webosinternals.ipkgservice.jar
  rm -f /var/usr/share/dbus-1/system-services/org.webosinternals.ipkgservice.service
  rm -f /var/etc/event.d/org.webosinternals.ipkgservice
fi

# Remove the java dbus service
rm -f /usr/lib/luna/java/org.webosinternals.ipkgservice.jar
rm -f /usr/share/dbus-1/system-services/org.webosinternals.ipkgservice.service

# Remove the upstart script
rm -f /etc/event.d/org.webosinternals.ipkgservice

# Restart the service handler
if [ -z "$IPKG_OFFLINE_ROOT" ]; then # Defined by recent installers that also support flags.
    /sbin/stop java-serviceboot
    /sbin/start java-serviceboot
fi

exit 0
